<loading-spinner overlay></loading-spinner>
<div class="d-flex justify-content-between">
  <h1>Single mortgage model with Monte Carlo prices</h1>
  <div class="d-flex">
    <div class="me-2">
      <pause-button></pause-button>

    </div>
    <div class="dropdown me-2">
      <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        Edit
      </button>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="/view/Edit%20Editable%20Files?id=4">Core model</a></li>
        <li><a class="dropdown-item" href="/view/Edit%20Editable%20Files?id=3">Calculation</a></li>
        <li><a class="dropdown-item" href="/view/Edit%20Editable%20Files?id=2">Layout</a></li>
      </ul>
    </div>
    <preset-select></preset-select>
  </div>
</div>
<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex">
      <div>
        <h3>Borrower Parameters</h3>
        <table>
          <tbody>
            <tr>
              <th>House value $</th>
              <td><input class="form-control" name="house_value" type="number" value="1500000" min="1000000"
                  max="3000000" step="1000" /></td>
            </tr>
            <tr>
              <th>Loan term Yrs</th>
              <td><input class="form-control" name="loan_duration" type="number" value="30" min="10" max="30"
                  step="1" /></td>
            </tr>
            <tr>
              <th>Annuity duration Yrs</th>
              <td><input class="form-control" name="annuity_duration" type="number" value="10" min="10" max="30"
                  step="1" /></td>
            </tr>
            <tr>
              <th>Loan type</th>
              <td><select class="form-select" name="loan_type">
                  <option>Interest only</option>
                  <option>Principal+Interest</option>
                  <option>Hybrid</option>
                </select></td>
            </tr>
            <tr>
              <th>Principal repayment</th>
              <td><input name="principal_repayment" type="checkbox" /></td>
            </tr>

            <tr>
              <th>Loan-to-value %</th>
              <td><input class="form-control" name="loan_to_value" type="number" value="80" min="10" max="100"
                  step="5" /></td>
            </tr>
            <tr>
              <th>Annual income $</th>
              <td><input class="form-control" name="annual_income" type="number" value="30000" min="1000" max="50000"
                  step="500" /></td>
            </tr>
            <tr>
              <th>At Risk Capital fraction %</th>
              <td><input class="form-control" name="at_risk_captital_fraction" type="number" value="0" min="0" max="100"
                  step="5" /></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="mx-3">
        <h3>Economic assumptions</h3>

        <table>
          <tbody>
            <tr>
              <th>Equity return %</th>
              <td><input class="form-control" name="equity_return" type="number" value="10.8" min="5" max="15"
                  step="0.25" /></td>
            </tr>
            <tr>
              <th>Volatility %</th>
              <td><input class="form-control" name="volatility" type="number" value="15" min="0" max="30" step="1" />
              </td>
            </tr>
            <tr>
              <th>Paths</th>
              <td><input class="form-control" name="total_paths" type="number" value="1000" min="1" max="20000"
                  step="100" /></td>
            </tr>
            <tr>
              <th>Random seed</th>
              <td><input class="form-control" name="random_seed" type="number" value="0" min="0" max="9999" step="1" />
              </td>
            </tr>
            <tr>
              <th>Cash rate %</th>
              <td><input class="form-control" name="cash_rate" type="number" value="3.85" min="0" max="10"
                  step="0.05" /></td>
            </tr>           
            <tr data-show-if="!hedged">
              <th>Insurer profit margin %</th>
              <td><input class="form-control" name="insurer_profit_margin" type="number" value="50" min="0" max="200"
                  step="5" /></td>
            </tr>
              <tr>
              <th>Hedged</th>
              <td><input name="hedged" type="checkbox" /></td>
            </tr>
            <tr data-show-if="hedged">
              <th>Hedging costs p.a. %</th>
              <td><input class="form-control" name="hedging_cost_pa" type="number" value="0.5" min="0" max="5"
                  step="0.05" />
              </td>
            </tr>
            <tr data-show-if="hedged">
              <th>Max loss p.a. %</th>
              <td><input class="form-control" name="hedging_max_loss" type="number" value="10" min="0" max="5"
                  step="0.05" />
              </td>
            </tr>
            <tr data-show-if="hedged">
              <th>Cap p.a. %</th>
              <td><input class="form-control" name="hedging_cap" type="number" value="20" min="0" max="5" step="0.05" />
              </td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="mx-3">
        <h3>Loan parameters</h3>

        <table>
          <tbody>
            <tr>
              <th>Wholesale lending margin %</th>
              <td><input class="form-control" name="wholesale_lending_margin" type="number" value="2" min="0" max="4"
                  step="0.05" /></td>
            </tr>
            <tr>
              <th>Additional loan margins %</th>
              <td><input class="form-control" name="additional_loan_margins" type="number" value="1.25" min="0" max="4"
                  step="0.05" /></td>
            </tr>
            <tr>
              <th>Holiday enter fraction %</th>
              <td><input class="form-control" name="holiday_enter_fraction" type="number" value="0.9" min="0" max="4"
                  step="0.05" /></td>
            </tr>
            <tr>
              <th>Holiday exit fraction %</th>
              <td><input class="form-control" name="holiday_exit_fraction" type="number" value="1.458" min="0" max="4"
                  step="0.05" /></td>
            </tr>
            <tr>
              <th>Subperform threshold quarters</th>
              <td><input class="form-control" name="subperform_loan_threshold_quarters" type="number" value="12" min="0"
                  max="40" step="1" /></td>
            </tr>

            <tr>
              <th>Deficit Repay Amount factor</th>
              <td>
                <input class="form-control" name="max_superpay_factor" type="number" value="1.261" min="0" max="4"
                  step="0.05" />

              </td>
            </tr>
            <tr>
              <th>Deficit Repay Start factor</th>
              <td>
                <input class="form-control" name="superpay_start_factor" type="number" value="1.50" min="1.0" max="4"
                  step="0.05" />
              </td>
            </tr>
            <tr>
              <th>Enable shared pool</th>
              <td>
                <input name="enable_pool" type="checkbox" />

              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<nav-tabs card>
  <tab label="Main outputs table" id="mainout">
    <df-table id="main-output" data="outdf" sticky-header>
      <column name="Quantity" align="left"></column>
      <column name="Formula" align="left"></column>
    </df-table>
  </tab>
  <tab label="Path table" id="pathtab">
    <div class="d-flex">
      <label for="path_table_type">Path output</label>
      <select class="form-select" name="path_table_type" style="width: 200px;">
        <option>Mean</option>
        <option>Median</option>
        <option>2% percentile</option>
        <option>25% percentile</option>
        <option>75% percentile</option>
      </select>
      <div class="rainy-hide-loading ms-2 mt-2">
        <download-link data="pathdf" format="csv"></download-link>
      </div>
      <div clas="ms-3">
        Download accounts table: <download-link data="accounts_table" format="csv"></download-link>

      </div>
    </div>
    <div class="rainy-hide-loading">
      <df-table id="path-output" data="pathdf" sticky-header>
        <column name="SP500" thousands-sep></column>
        <column name="Interest" thousands-sep round></column>
        <column name="Loan size" thousands-sep round></column>
        <column name="Units" thousands-sep round></column>
        <column name="Reinvestment" thousands-sep round></column>
        <column name="InterestDeficit" thousands-sep round></column>
        <column name="CapitalDeficit" thousands-sep round></column>
        <column name="Surplus" thousands-sep round></column>
        <column name="FunderEarned" thousands-sep round></column>
        <column name="AnnuityIncome" thousands-sep round></column>
        <column name="InterestPaid" thousands-sep round></column>
        <column name="InterestPaidToFunder" thousands-sep round></column>
        <column name="UnitsSold" thousands-sep></column>
        <column name="CumUnitsSold" thousands-sep></column>
        <column name="UnitsToPrincipal" round></column>
        <column name="TotalUnitsSold" round></column>
      </df-table>
    </div>
  </tab>
  <tab label="Prices plot" id="mcpricetab"><xy-plot id="mcplot" showlegend="false">
      <traces x="mean_period" ys="mc_prices" type="lines" color="rgb(0, 0, 128)"></traces>
      <axis dir="y" title="SP500 price" type="log"></axis>
    </xy-plot>
  </tab>
  <tab label="Timeline plot 1" id="timeplottab">
    <xy-plot id="meanplot1">
      <trace x="mean_period" y="mean_reinvest" type="lines" name="Reinvestment account"></trace>
      <trace x="mean_period" y="mean_loan" type="lines" name="Loan"></trace>
      <trace x="mean_period" y="mean_deficit" type="lines" name="Interest deficit"></trace>
      <axis dir="y" title="Mean $Value"></axis>
    </xy-plot>
    <xy-plot id="meanplot2">
      <trace x="mean_period" y="mean_hedged_units" type="lines" name="Hedged Units"></trace>
      <trace x="mean_period" y="mean_insured_units" type="lines" name="Insured Units"></trace>
      <trace x="mean_period" y="pool_units" type="lines" name="Pooled Units"></trace>

      <axis dir="y" title="Mean Units"></axis>
    </xy-plot>
  </tab>
  <tab label="Timeline plot 2" id="timeplottab1">
    <xy-plot id="meanplot3">
      <trace x="mean_period" y="mean_cumanninc" width="3" type="lines" name="Cum. Annuity Income"></trace>
      <trace x="mean_period" y="mean_cumintraccr" width="3" type="lines" name="Cum. Interest Accrued"></trace>
      <trace x="mean_period" y="mean_cumintpaid" width="3" type="lines" name="Cum. Interest Paid"></trace>
      <trace x="mean_period" y="mean_loan" width="3" type="lines" name="Loan"></trace>
      <trace x="mean_period" y="mean_surplus" width="3" type="lines" name="Surplus"></trace>
      <trace x="mean_period" y="mean_units" width="3" yaxis="y2" type="lines" name="S&P Units"></trace>

      <axis dir="y" title="Mean $Value"></axis>
      <axis dir="y" n="2" title="Mean S&P Units" side="right" overlaying="y"></axis>
      <axis dir="x" title="Quarter"></axis>
    </xy-plot>
  </tab>
</nav-tabs>

<style>
  #rainy-pause-button {
    height: 40px;
  }

  table#path-output,
  table#main-output {
    font-feature-settings: 'tnum'
  }
</style>