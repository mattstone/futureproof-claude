<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HonkyPong Sprite Extraction Test</title>
    <style>
        body {
            background: #222;
            color: white;
            font-family: monospace;
            padding: 20px;
        }
        
        .sprite-sheet {
            margin: 20px 0;
            border: 2px solid #555;
            padding: 10px;
        }
        
        .sprite-sheet h3 {
            margin-top: 0;
            color: #ff6;
        }
        
        .sprite-sheet img {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            border: 1px solid #666;
        }
        
        .zoom-controls {
            margin: 10px 0;
        }
        
        .zoom-controls button {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        
        .zoom-controls button:hover {
            background: #555;
        }
        
        .sprite-info {
            margin: 10px 0;
            background: #333;
            padding: 10px;
            border-radius: 4px;
        }
        
        .extracted-sprites {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: #111;
            border-radius: 4px;
        }
        
        .sprite-tile {
            border: 1px solid #666;
            padding: 5px;
            background: #333;
            text-align: center;
        }
        
        .sprite-tile canvas {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .coordinates {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .controls {
            background: #333;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .controls label {
            display: inline-block;
            width: 120px;
            margin-right: 10px;
        }
        
        .controls input {
            background: #222;
            color: white;
            border: 1px solid #666;
            padding: 3px;
            width: 60px;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ® HonkyPong Sprite Extraction Test</h1>
    
    <div class="controls">
        <h3>Extraction Settings</h3>
        <div>
            <label>Sprite Width:</label>
            <input type="number" id="spriteWidth" value="16">
            <label>Sprite Height:</label>
            <input type="number" id="spriteHeight" value="16">
        </div>
        <div style="margin-top: 10px;">
            <label>Start X:</label>
            <input type="number" id="startX" value="0">
            <label>Start Y:</label>
            <input type="number" id="startY" value="0">
        </div>
        <div style="margin-top: 10px;">
            <label>Columns:</label>
            <input type="number" id="columns" value="8">
            <label>Rows:</label>
            <input type="number" id="rows" value="3">
        </div>
        <button onclick="extractSprites()" style="margin-top: 10px; padding: 8px 16px;">Extract Sprites</button>
    </div>
    
    <!-- Mario Sprites -->
    <div class="sprite-sheet">
        <h3>Mario Sprites</h3>
        <div class="zoom-controls">
            <button onclick="zoom('mario', 1)">1x</button>
            <button onclick="zoom('mario', 2)">2x</button>
            <button onclick="zoom('mario', 4)">4x</button>
            <button onclick="zoom('mario', 8)">8x</button>
        </div>
        <div>
            <img id="mario-sheet" src="/assets/arcade/honkypong/sprites/mario.png" alt="Mario Sprites">
        </div>
        <div class="sprite-info">
            <div>Image URL: <span id="mario-url">/assets/arcade/honkypong/sprites/mario.png</span></div>
        </div>
        <div class="sprite-info">
            <div>Image size: <span id="mario-size">Loading...</span></div>
            <div>Mouse position: <span id="mario-coords">-</span></div>
        </div>
        <div class="extracted-sprites" id="mario-extracted"></div>
    </div>
    
    <!-- Enemy Sprites -->
    <div class="sprite-sheet">
        <h3>Enemy Sprites</h3>
        <div class="zoom-controls">
            <button onclick="zoom('enemies', 1)">1x</button>
            <button onclick="zoom('enemies', 2)">2x</button>
            <button onclick="zoom('enemies', 4)">4x</button>
            <button onclick="zoom('enemies', 8)">8x</button>
        </div>
        <div>
            <img id="enemies-sheet" src="/assets/arcade/honkypong/sprites/enemies.png" alt="Enemy Sprites">
        </div>
        <div class="sprite-info">
            <div>Image size: <span id="enemies-size">Loading...</span></div>
            <div>Mouse position: <span id="enemies-coords">-</span></div>
        </div>
        <div class="extracted-sprites" id="enemies-extracted"></div>
    </div>
    
    <!-- Pauline Sprites -->
    <div class="sprite-sheet">
        <h3>Pauline Sprites</h3>
        <div class="zoom-controls">
            <button onclick="zoom('pauline', 1)">1x</button>
            <button onclick="zoom('pauline', 2)">2x</button>
            <button onclick="zoom('pauline', 4)">4x</button>
            <button onclick="zoom('pauline', 8)">8x</button>
        </div>
        <div>
            <img id="pauline-sheet" src="/assets/arcade/honkypong/sprites/pauline.png" alt="Pauline Sprites">
        </div>
        <div class="sprite-info">
            <div>Image size: <span id="pauline-size">Loading...</span></div>
            <div>Mouse position: <span id="pauline-coords">-</span></div>
        </div>
        <div class="extracted-sprites" id="pauline-extracted"></div>
    </div>

    <script>
        let currentSheet = 'mario';
        
        function zoom(sheetName, scale) {
            const img = document.getElementById(sheetName + '-sheet');
            const naturalWidth = img.naturalWidth;
            const naturalHeight = img.naturalHeight;
            img.style.width = (naturalWidth * scale) + 'px';
            img.style.height = (naturalHeight * scale) + 'px';
        }
        
        // Track mouse coordinates
        function setupMouseTracking() {
            ['mario', 'enemies', 'pauline'].forEach(sheetName => {
                const img = document.getElementById(sheetName + '-sheet');
                
                img.onload = function() {
                    document.getElementById(sheetName + '-size').textContent = 
                        `${this.naturalWidth} x ${this.naturalHeight}`;
                };
                
                img.addEventListener('mousemove', function(e) {
                    const rect = this.getBoundingClientRect();
                    const scaleX = this.naturalWidth / rect.width;
                    const scaleY = this.naturalHeight / rect.height;
                    
                    const x = Math.floor((e.clientX - rect.left) * scaleX);
                    const y = Math.floor((e.clientY - rect.top) * scaleY);
                    
                    document.getElementById(sheetName + '-coords').textContent = `${x}, ${y}`;
                });
                
                img.addEventListener('mouseleave', function() {
                    document.getElementById(sheetName + '-coords').textContent = '-';
                });
            });
        }
        
        function extractSprites() {
            const width = parseInt(document.getElementById('spriteWidth').value);
            const height = parseInt(document.getElementById('spriteHeight').value);
            const startX = parseInt(document.getElementById('startX').value);
            const startY = parseInt(document.getElementById('startY').value);
            const cols = parseInt(document.getElementById('columns').value);
            const rows = parseInt(document.getElementById('rows').value);
            
            // Clear previous extractions
            ['mario', 'enemies', 'pauline'].forEach(sheetName => {
                document.getElementById(sheetName + '-extracted').innerHTML = '';
            });
            
            // Check if images are loaded before extracting
            ['mario', 'enemies', 'pauline'].forEach(sheetName => {
                const img = document.getElementById(sheetName + '-sheet');
                if (img.complete && img.naturalWidth > 0) {
                    extractFromSheet(sheetName, width, height, startX, startY, cols, rows);
                } else {
                    console.log(`Image ${sheetName} not loaded yet, waiting...`);
                    img.onload = () => {
                        extractFromSheet(sheetName, width, height, startX, startY, cols, rows);
                    };
                    // Also handle error case
                    img.onerror = () => {
                        console.error(`Failed to load image: ${img.src}`);
                        document.getElementById(sheetName + '-extracted').innerHTML = 
                            `<div style="color: red;">Failed to load: ${img.src}</div>`;
                    };
                }
            });
        }
        
        function extractFromSheet(sheetName, width, height, startX, startY, cols, rows) {
            const img = document.getElementById(sheetName + '-sheet');
            const container = document.getElementById(sheetName + '-extracted');
            
            // Create a canvas to extract sprites
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = width;
            canvas.height = height;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const x = startX + (col * width);
                    const y = startY + (row * height);
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, width, height);
                    
                    // Draw the sprite portion
                    ctx.drawImage(img, x, y, width, height, 0, 0, width, height);
                    
                    // Create display canvas
                    const displayCanvas = document.createElement('canvas');
                    displayCanvas.width = width;
                    displayCanvas.height = height;
                    const displayCtx = displayCanvas.getContext('2d');
                    displayCtx.drawImage(canvas, 0, 0);
                    
                    // Create sprite tile
                    const tile = document.createElement('div');
                    tile.className = 'sprite-tile';
                    
                    // Scale up for visibility
                    displayCanvas.style.width = (width * 3) + 'px';
                    displayCanvas.style.height = (height * 3) + 'px';
                    
                    const coords = document.createElement('div');
                    coords.className = 'coordinates';
                    coords.textContent = `${col},${row} (${x},${y})`;
                    
                    tile.appendChild(displayCanvas);
                    tile.appendChild(coords);
                    container.appendChild(tile);
                }
            }
        }
        
        // Initialize
        setupMouseTracking();
        
        // Set initial zoom
        setTimeout(() => {
            zoom('mario', 2);
            zoom('enemies', 2);
            zoom('pauline', 2);
        }, 100);
    </script>
</body>
</html>