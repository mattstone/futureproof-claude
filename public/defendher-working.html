<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DefendHer - Defender Clone</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            color: #0f0;
            font-size: 48px;
            margin: 20px 0;
            text-shadow: 0 0 10px #0f0;
        }
        .subtitle {
            color: #fff;
            font-size: 20px;
            margin-bottom: 20px;
        }
        .stats {
            font-size: 20px;
            margin: 20px 0;
            display: flex;
            gap: 40px;
        }
        canvas {
            border: 4px solid #0f0;
            display: block;
            margin: 20px;
            background: #000;
            box-shadow: 0 0 20px #0f0;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            background: #0f0;
            color: #000;
            border: none;
            cursor: pointer;
            margin: 10px;
            font-family: 'Courier New', monospace;
        }
        button:hover {
            background: #0ff;
        }
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border: 4px solid #0f0;
            box-shadow: 0 0 30px #0f0;
            text-align: center;
            display: none;
            z-index: 1000;
        }
        .game-over.show { display: block; }
    </style>
</head>
<body>
    <h1>üöÄ DEFENDHER üöÄ</h1>
    <p class="subtitle">Save Humanity from Alien Invasion!</p>

    <div class="stats">
        <span>SCORE: <span id="score">0</span></span>
        <span>LIVES: <span id="lives">3</span></span>
        <span>WAVE: <span id="level">1</span></span>
        <span>HUMANS: <span id="humans">10</span></span>
    </div>

    <canvas id="game" width="900" height="600"></canvas>

    <div style="text-align: center; color: #fff;">
        <button id="startBtn">LAUNCH DEFENSE</button>
        <p>‚Üê ‚Üí Move | ‚Üë Thrust | SPACE Shoot | ‚Üì Pick Up/Drop</p>
    </div>

    <div id="gameOver" class="game-over">
        <h2>MISSION COMPLETE</h2>
        <p>Score: <span id="finalScore">0</span></p>
        <p>Humans Saved: <span id="finalHumans">0</span></p>
        <button id="restartBtn">NEW MISSION</button>
    </div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');

        const WORLD_WIDTH = 3600; // Wide scrolling world
        const GRAVITY = 0.1;

        let gameState = 'ready';
        let score = 0;
        let lives = 3;
        let level = 1;
        let keys = {};
        let cameraX = 0;

        // Ship
        const ship = {
            x: 450,
            y: 300,
            vx: 0,
            vy: 0,
            angle: 0,
            w: 30,
            h: 20,
            thrusting: false,
            carrying: null,
            invincible: 0
        };

        let bullets = [];
        let aliens = [];
        let alienBullets = [];
        let humans = [];
        let particles = [];

        document.addEventListener('keydown', e => {
            keys[e.key] = true;
            if (e.key === ' ' && gameState === 'playing') {
                shoot();
                e.preventDefault();
            }
            if (e.key === 'ArrowDown' && gameState === 'playing') {
                pickupOrDrop();
                e.preventDefault();
            }
        });

        document.addEventListener('keyup', e => keys[e.key] = false);

        document.getElementById('startBtn').onclick = startGame;
        document.getElementById('restartBtn').onclick = restart;

        function startGame() {
            if (gameState === 'ready') {
                gameState = 'playing';
                initLevel();
                gameLoop();
            }
        }

        function restart() {
            score = 0;
            lives = 3;
            level = 1;
            ship.x = 450;
            ship.y = 300;
            ship.vx = 0;
            ship.vy = 0;
            ship.carrying = null;
            bullets = [];
            aliens = [];
            alienBullets = [];
            particles = [];
            gameState = 'playing';
            document.getElementById('gameOver').classList.remove('show');
            initLevel();
            updateHUD();
        }

        function initLevel() {
            aliens = [];
            humans = [];
            bullets = [];
            alienBullets = [];

            // Spawn humans on ground
            for (let i = 0; i < 10; i++) {
                humans.push({
                    x: Math.random() * (WORLD_WIDTH - 200) + 100,
                    y: 550,
                    vx: 0,
                    vy: 0,
                    state: 'walking', // walking, captured, falling, saved
                    walkDir: Math.random() < 0.5 ? -1 : 1
                });
            }

            // Spawn aliens
            const alienCount = 5 + level * 2;
            for (let i = 0; i < alienCount; i++) {
                aliens.push({
                    x: Math.random() * WORLD_WIDTH,
                    y: Math.random() * 200 + 50,
                    vx: (Math.random() - 0.5) * 2,
                    vy: 0,
                    type: Math.random() < 0.7 ? 'lander' : 'bomber',
                    capturing: null,
                    shootTimer: Math.random() * 120
                });
            }
        }

        function gameLoop() {
            if (gameState !== 'playing') return;

            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // Ship controls
            if (keys['ArrowLeft']) {
                ship.vx -= 0.3;
            }
            if (keys['ArrowRight']) {
                ship.vx += 0.3;
            }

            ship.thrusting = keys['ArrowUp'];

            if (ship.thrusting) {
                ship.vy -= 0.2;

                // Thrust particles
                if (Math.random() < 0.3) {
                    particles.push({
                        x: ship.x,
                        y: ship.y + 10,
                        vx: (Math.random() - 0.5) * 2,
                        vy: Math.random() * 2 + 1,
                        life: 20,
                        color: '#fa0'
                    });
                }
            } else {
                ship.vy += GRAVITY;
            }

            // Apply friction
            ship.vx *= 0.98;
            ship.vy *= 0.98;

            // Limit speed
            const maxSpeed = 8;
            if (Math.abs(ship.vx) > maxSpeed) ship.vx = maxSpeed * Math.sign(ship.vx);
            if (Math.abs(ship.vy) > maxSpeed) ship.vy = maxSpeed * Math.sign(ship.vy);

            // Move ship
            ship.x += ship.vx;
            ship.y += ship.vy;

            // Wrap horizontally
            if (ship.x < 0) ship.x = WORLD_WIDTH;
            if (ship.x > WORLD_WIDTH) ship.x = 0;

            // Keep on screen vertically
            if (ship.y < 10) ship.y = 10;
            if (ship.y > 570) ship.y = 570;

            // Camera follows ship
            cameraX = ship.x - canvas.width / 2;
            if (cameraX < 0) cameraX = 0;
            if (cameraX > WORLD_WIDTH - canvas.width) cameraX = WORLD_WIDTH - canvas.width;

            // Invincibility
            if (ship.invincible > 0) ship.invincible--;

            // Human being carried
            if (ship.carrying !== null) {
                ship.carrying.x = ship.x;
                ship.carrying.y = ship.y + 20;
                ship.carrying.state = 'carried';
            }

            // Update bullets
            bullets.forEach((b, i) => {
                b.x += b.vx;
                b.y += b.vy;
                b.life--;

                if (b.x < 0 || b.x > WORLD_WIDTH || b.y < 0 || b.y > 600 || b.life <= 0) {
                    bullets.splice(i, 1);
                }
            });

            alienBullets.forEach((b, i) => {
                b.x += b.vx;
                b.y += b.vy;
                b.life--;

                if (b.x < 0 || b.x > WORLD_WIDTH || b.y < 0 || b.y > 600 || b.life <= 0) {
                    alienBullets.splice(i, 1);
                }
            });

            // Update aliens
            aliens.forEach((alien, ai) => {
                alien.x += alien.vx;
                alien.y += alien.vy;

                // Wrap
                if (alien.x < 0) alien.x = WORLD_WIDTH;
                if (alien.x > WORLD_WIDTH) alien.x = 0;

                // AI behavior
                if (alien.type === 'lander' && !alien.capturing) {
                    // Try to capture humans
                    const nearbyHuman = humans.find(h =>
                        h.state === 'walking' &&
                        Math.abs(h.x - alien.x) < 100 &&
                        alien.y < 400
                    );

                    if (nearbyHuman) {
                        alien.capturing = nearbyHuman;
                        nearbyHuman.state = 'captured';
                    }
                }

                if (alien.capturing) {
                    // Move toward human
                    const dx = alien.capturing.x - alien.x;
                    const dy = alien.capturing.y - 50 - alien.y;
                    alien.vx = dx * 0.02;
                    alien.vy = dy * 0.02;

                    // Lift human
                    if (Math.abs(dy) < 20) {
                        alien.capturing.x = alien.x;
                        alien.capturing.y = alien.y + 20;
                        alien.vy = -1; // Fly up
                    }
                }

                // Shoot at ship occasionally
                alien.shootTimer--;
                if (alien.shootTimer <= 0 && Math.abs(alien.x - ship.x) < 400) {
                    const dx = ship.x - alien.x;
                    const dy = ship.y - alien.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    alienBullets.push({
                        x: alien.x,
                        y: alien.y,
                        vx: (dx / dist) * 4,
                        vy: (dy / dist) * 4,
                        life: 100
                    });
                    alien.shootTimer = 60 + Math.random() * 120;
                }

                // Keep in bounds
                if (alien.y < 20) alien.y = 20;
                if (alien.y > 500) alien.y = 500;
            });

            // Update humans
            humans.forEach(human => {
                if (human.state === 'walking') {
                    human.x += human.walkDir * 0.5;

                    // Turn around at edges
                    if (human.x < 50 || human.x > WORLD_WIDTH - 50) {
                        human.walkDir *= -1;
                    }
                } else if (human.state === 'falling') {
                    human.vy += GRAVITY * 2;
                    human.y += human.vy;

                    if (human.y >= 550) {
                        human.y = 550;
                        human.state = 'walking';
                        human.vy = 0;
                    }
                }
            });

            // Update particles
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if (p.life <= 0) particles.splice(i, 1);
            });

            // Collision detection

            // Bullets vs aliens
            bullets.forEach((bullet, bi) => {
                aliens.forEach((alien, ai) => {
                    if (collision(bullet, alien, 20)) {
                        bullets.splice(bi, 1);
                        aliens.splice(ai, 1);
                        score += alien.type === 'lander' ? 150 : 100;

                        // Free captured human
                        if (alien.capturing) {
                            alien.capturing.state = 'falling';
                            alien.capturing.vy = 0;
                        }

                        // Explosion
                        for (let i = 0; i < 15; i++) {
                            particles.push({
                                x: alien.x,
                                y: alien.y,
                                vx: (Math.random() - 0.5) * 4,
                                vy: (Math.random() - 0.5) * 4,
                                life: 30,
                                color: '#f00'
                            });
                        }

                        updateHUD();
                    }
                });
            });

            // Alien bullets vs ship
            if (ship.invincible === 0) {
                alienBullets.forEach((bullet, bi) => {
                    if (collision(bullet, ship, 15)) {
                        alienBullets.splice(bi, 1);
                        loseLife();
                    }
                });

                // Ship vs aliens
                aliens.forEach((alien, ai) => {
                    if (collision(ship, alien, 20)) {
                        aliens.splice(ai, 1);
                        loseLife();
                    }
                });
            }

            // Check win condition
            const activeHumans = humans.filter(h => h.state !== 'saved').length;
            if (aliens.length === 0 && activeHumans === 0) {
                level++;
                updateHUD();
                initLevel();
            }

            // Check lose condition (all humans captured/dead)
            const aliveHumans = humans.filter(h => h.state === 'walking' || h.state === 'falling' || h.state === 'captured').length;
            if (aliveHumans === 0 && aliens.length > 0) {
                gameOver();
            }
        }

        function shoot() {
            if (bullets.length < 3) {
                bullets.push({
                    x: ship.x + 15,
                    y: ship.y,
                    vx: 8,
                    vy: 0,
                    life: 100
                });
            }
        }

        function pickupOrDrop() {
            if (ship.carrying) {
                // Drop human
                ship.carrying.state = 'falling';
                ship.carrying.vy = 0;
                ship.carrying = null;
            } else {
                // Try to pick up human
                const nearbyHuman = humans.find(h =>
                    (h.state === 'walking' || h.state === 'falling') &&
                    Math.abs(h.x - ship.x) < 30 &&
                    Math.abs(h.y - ship.y) < 40
                );

                if (nearbyHuman) {
                    ship.carrying = nearbyHuman;
                    score += 50;
                    updateHUD();
                }
            }
        }

        function collision(a, b, radius) {
            const dx = a.x - b.x;
            const dy = a.y - b.y;
            return Math.sqrt(dx * dx + dy * dy) < radius;
        }

        function loseLife() {
            lives--;
            updateHUD();

            if (lives <= 0) {
                gameOver();
            } else {
                ship.x = 450;
                ship.y = 300;
                ship.vx = 0;
                ship.vy = 0;
                ship.carrying = null;
                ship.invincible = 120;
            }
        }

        function gameOver() {
            gameState = 'gameover';
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalHumans').textContent = humans.filter(h => h.state === 'saved').length;
            document.getElementById('gameOver').classList.add('show');
        }

        function updateHUD() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
            document.getElementById('humans').textContent = humans.filter(h => h.state === 'walking' || h.state === 'falling').length;
        }

        function render() {
            // Clear
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars (parallax)
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 100; i++) {
                const x = (i * 234 + cameraX * 0.3) % canvas.width;
                const y = (i * 567) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }

            // Ground
            ctx.strokeStyle = '#0f0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, 580);
            for (let x = 0; x < canvas.width; x += 20) {
                const worldX = x + cameraX;
                const y = 580 + Math.sin(worldX * 0.02) * 5;
                ctx.lineTo(x, y);
            }
            ctx.stroke();

            ctx.save();
            ctx.translate(-cameraX, 0);

            // Humans
            humans.forEach(human => {
                if (human.state === 'captured' || human.state === 'carried') return;

                ctx.fillStyle = human.state === 'saved' ? '#0ff' : '#fff';
                ctx.fillRect(human.x - 3, human.y - 10, 6, 10);
                ctx.fillRect(human.x - 2, human.y - 12, 4, 2); // Head
            });

            // Aliens
            aliens.forEach(alien => {
                ctx.fillStyle = alien.type === 'lander' ? '#f0f' : '#f00';

                // Body
                ctx.fillRect(alien.x - 12, alien.y - 8, 24, 16);

                // Wings/appendages
                ctx.fillRect(alien.x - 18, alien.y - 2, 6, 4);
                ctx.fillRect(alien.x + 12, alien.y - 2, 6, 4);

                // Captured human line
                if (alien.capturing) {
                    ctx.strokeStyle = '#f0f';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(alien.x, alien.y + 8);
                    ctx.lineTo(alien.capturing.x, alien.capturing.y);
                    ctx.stroke();
                }
            });

            // Bullets
            ctx.fillStyle = '#0ff';
            bullets.forEach(b => {
                ctx.fillRect(b.x, b.y - 1, 4, 2);
            });

            ctx.fillStyle = '#f00';
            alienBullets.forEach(b => {
                ctx.fillRect(b.x - 1, b.y - 1, 2, 2);
            });

            // Ship (flicker if invincible)
            if (ship.invincible === 0 || Math.floor(ship.invincible / 5) % 2 === 0) {
                ctx.strokeStyle = '#0f0';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(ship.x + 15, ship.y);
                ctx.lineTo(ship.x - 15, ship.y - 8);
                ctx.lineTo(ship.x - 10, ship.y);
                ctx.lineTo(ship.x - 15, ship.y + 8);
                ctx.closePath();
                ctx.stroke();

                // Thrust
                if (ship.thrusting) {
                    ctx.strokeStyle = '#fa0';
                    ctx.beginPath();
                    ctx.moveTo(ship.x - 10, ship.y - 3);
                    ctx.lineTo(ship.x - 18, ship.y);
                    ctx.lineTo(ship.x - 10, ship.y + 3);
                    ctx.stroke();
                }

                // Carried human
                if (ship.carrying) {
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(ship.x - 3, ship.y + 15, 6, 10);
                }
            }

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life / 30;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 2, 2);
            });
            ctx.globalAlpha = 1;

            ctx.restore();

            // Minimap
            const miniW = 180;
            const miniH = 30;
            const miniX = canvas.width - miniW - 10;
            const miniY = 10;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(miniX, miniY, miniW, miniH);
            ctx.strokeStyle = '#0f0';
            ctx.strokeRect(miniX, miniY, miniW, miniH);

            // Ship on minimap
            const shipMiniX = miniX + (ship.x / WORLD_WIDTH) * miniW;
            ctx.fillStyle = '#0f0';
            ctx.fillRect(shipMiniX - 1, miniY + miniH / 2 - 1, 2, 2);

            // Aliens on minimap
            ctx.fillStyle = '#f00';
            aliens.forEach(alien => {
                const ax = miniX + (alien.x / WORLD_WIDTH) * miniW;
                ctx.fillRect(ax, miniY + 2, 1, miniH - 4);
            });

            // Humans on minimap
            ctx.fillStyle = '#fff';
            humans.forEach(human => {
                if (human.state !== 'saved') {
                    const hx = miniX + (human.x / WORLD_WIDTH) * miniW;
                    ctx.fillRect(hx, miniY + miniH - 3, 1, 2);
                }
            });
        }

        updateHUD();
    </script>
</body>
</html>