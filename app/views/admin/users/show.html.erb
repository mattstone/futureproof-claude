<% content_for :page_title, "User Details" %>

<div class="admin-actions-bar">
  <div>
    <%= link_to "← Back to Users", admin_users_path, class: "admin-btn admin-btn-secondary" %>
  </div>
  
  <div class="admin-actions">
    <%= link_to "Edit User", edit_admin_user_path(@user), class: "admin-btn admin-btn-primary" %>
  </div>
</div>

<div class="admin-form">
  <h2><%= @user.display_name %></h2>
  
  <div class="user-details">
    <div class="detail-row">
      <strong>Email:</strong>
      <%= @user.email %>
    </div>
    
    <div class="detail-row">
      <strong>First Name:</strong>
      <%= @user.first_name %>
    </div>
    
    <div class="detail-row">
      <strong>Last Name:</strong>
      <%= @user.last_name %>
    </div>
    
    <div class="detail-row">
      <strong>Country of Residence:</strong>
      <%= @user.country_of_residence %>
    </div>
    
    <div class="detail-row">
      <strong>Role:</strong>
      <% if @user.admin? %>
        <span class="admin-badge admin-badge-admin">Admin</span>
      <% else %>
        <span class="admin-badge admin-badge-user">User</span>
      <% end %>
    </div>
    
    <div class="detail-row">
      <strong>Account Status:</strong>
      <% if @user.confirmed? %>
        <span class="admin-badge admin-badge-user">Confirmed</span>
      <% else %>
        <span class="admin-badge admin-badge-admin">Pending Confirmation</span>
      <% end %>
    </div>
    
    <div class="detail-row">
      <strong>Created:</strong>
      <%= @user.created_at.strftime("%B %d, %Y at %I:%M %p") %>
    </div>
    
    <div class="detail-row">
      <strong>Last Updated:</strong>
      <%= @user.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
    </div>
  </div>
</div>

<!-- Change History Section -->
<div class="admin-form" style="margin-top: 32px;">
  <h3>Change History</h3>
  
  <% if @user_versions.any? %>
    <div class="versions-list">
      <% @user_versions.each do |version| %>
        <div class="version-entry">
          <div class="version-header">
            <div class="version-meta">
              <strong><%= version.admin_user.display_name %></strong>
              <span class="version-action"><%= version.action_description %></span>
              <span class="version-date"><%= version.formatted_created_at %></span>
            </div>
          </div>
          
          <% if version.change_details.present? %>
            <div class="version-details">
              <%= version.change_details %>
            </div>
          <% end %>
          
          <% if version.has_field_changes? %>
            <div class="version-changes">
              <% version.detailed_changes.each do |change| %>
                <div class="field-change">
                  <span class="field-name"><%= change[:field] %>:</span>
                  <span class="change-from"><%= change[:from] %></span>
                  <span class="change-arrow">→</span>
                  <span class="change-to"><%= change[:to] %></span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="no-versions">No change history available.</p>
  <% end %>
</div>

<style>
.user-details {
  margin-top: 24px;
}

.detail-row {
  padding: 12px 0;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  gap: 16px;
}

.detail-row:last-child {
  border-bottom: none;
}

.detail-row strong {
  min-width: 180px;
  color: #374151;
}

/* Change History Styles */
.versions-list {
  margin-top: 16px;
}

.version-entry {
  padding: 16px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  margin-bottom: 12px;
  background-color: #f9fafb;
}

.version-header {
  margin-bottom: 8px;
}

.version-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.version-action {
  background-color: #e5e7eb;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
  color: #6b7280;
}

.version-date {
  color: #6b7280;
  font-size: 14px;
}

.version-details {
  color: #6b7280;
  margin-bottom: 8px;
  font-style: italic;
}

.version-changes {
  margin-top: 8px;
}

.field-change {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 4px;
  flex-wrap: wrap;
}

.field-name {
  font-weight: 600;
  min-width: 120px;
  color: #374151;
}

.change-from {
  background-color: #fef2f2;
  border: 1px solid #fecaca;
  padding: 2px 6px;
  border-radius: 4px;
  color: #dc2626;
  font-size: 12px;
}

.change-arrow {
  color: #6b7280;
  font-weight: bold;
}

.change-to {
  background-color: #f0fdf4;
  border: 1px solid #bbf7d0;
  padding: 2px 6px;
  border-radius: 4px;
  color: #16a34a;
  font-size: 12px;
}

.no-versions {
  color: #6b7280;
  font-style: italic;
  text-align: center;
  padding: 32px;
}
</style>