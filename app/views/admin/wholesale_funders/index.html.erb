<% content_for :page_title, "Wholesale Funders" %>

<!-- Flash messages container for Turbo Stream updates -->
<div id="flash-messages"></div>

<div class="admin-actions-bar">
  <div class="admin-search">
    <%= form_with(url: search_admin_wholesale_funders_path, method: :post, local: false, class: "search-form", 
                  data: { turbo_stream: true }) do |form| %>
      <%= form.text_field :search, placeholder: "Search by name or country...", value: params[:search], 
                         oninput: "this.form.requestSubmit();" %>
      <%= form.hidden_field :country, value: params[:country] %>
      <%= form.hidden_field :currency, value: params[:currency] %>
    <% end %>
  </div>
  
  <div class="admin-filter">
    <%= form_with(url: search_admin_wholesale_funders_path, method: :post, local: false, class: "filter-form",
                  data: { turbo_stream: true }) do |form| %>
      <%= form.select :country, 
            options_for_select([["All Countries", ""]] + @countries.map { |c| [c, c] }, params[:country]),
            {},
            { 
              class: "filter-select",
              onchange: "this.form.requestSubmit();"
            } %>
      <%= form.hidden_field :search, value: params[:search] %>
      <%= form.hidden_field :currency, value: params[:currency] %>
    <% end %>
  </div>

  <div class="admin-filter">
    <%= form_with(url: search_admin_wholesale_funders_path, method: :post, local: false, class: "filter-form",
                  data: { turbo_stream: true }) do |form| %>
      <%= form.select :currency, 
            options_for_select([["All Currencies", ""]] + @currencies.map { |c| [c, c] }, params[:currency]),
            {},
            { 
              class: "filter-select",
              onchange: "this.form.requestSubmit();"
            } %>
      <%= form.hidden_field :search, value: params[:search] %>
      <%= form.hidden_field :country, value: params[:country] %>
    <% end %>
  </div>
  
  <div class="admin-actions">
    <div class="wholesale-funders-summary">
      Total Wholesale Funders: <span id="wholesale-funders-count" class="count-badge">
        <%= @wholesale_funders.total_count || WholesaleFunder.count %>
      </span>
    </div>
    <%= link_to "New Wholesale Funder", new_admin_wholesale_funder_path, class: "admin-btn admin-btn-primary" %>
  </div>
</div>

<%= render 'results' %>

<style>
/* Filter styles */
.admin-actions-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

.admin-search {
  flex: 1;
  min-width: 200px;
}

.search-form {
  margin: 0;
}

.search-form input[type="text"] {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 14px;
  background: white;
}

.search-form input[type="text"]:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.admin-filter {
  display: flex;
  align-items: center;
}

.filter-form {
  margin: 0;
}

.filter-select {
  padding: 8px 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  background: white;
  font-size: 14px;
  color: #374151;
  min-width: 150px;
  cursor: pointer;
}

.filter-select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.admin-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.wholesale-funders-summary {
  font-size: 14px;
  color: #6b7280;
}

.count-badge {
  font-weight: 600;
  color: #059669;
  background: #dcfce7;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
}

/* Table styles */
.name-cell {
  width: 20%;
  min-width: 150px;
}

.country-cell {
  width: 10%;
  min-width: 100px;
}

.currency-cell {
  width: 8%;
  min-width: 80px;
}

.pools-cell {
  width: 8%;
  min-width: 80px;
  text-align: center;
}

.capital-cell {
  width: 12%;
  min-width: 120px;
  text-align: right;
}

.allocated-cell {
  width: 15%;
  min-width: 140px;
  text-align: right;
}

.lenders-cell {
  width: 10%;
  min-width: 100px;
  text-align: center;
}

.actions-cell {
  width: 17%;
  min-width: 200px;
  white-space: nowrap;
}

.country-name {
  font-weight: 500;
  color: #374151;
}

/* Pools summary */
.pools-summary {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.pools-count {
  font-weight: 600;
  font-size: 18px;
  color: #059669;
}

.pools-label {
  color: #6b7280;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Lenders summary */
.lenders-summary {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.lenders-count {
  font-weight: 600;
  font-size: 18px;
  color: #7c3aed;
}

.lenders-label {
  color: #6b7280;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Capital and allocation amounts */
.capital-amount {
  font-weight: 600;
  color: #059669;
  font-size: 14px;
}

.allocated-amount {
  font-weight: 600;
  color: #dc2626;
  font-size: 14px;
}

.no-capital,
.no-allocation {
  color: #9ca3af;
  font-size: 14px;
}

.allocation-summary {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

/* Mini allocation bars for table */
.mini-allocation-bar {
  position: relative;
  background: #e5e7eb;
  border-radius: 3px;
  height: 12px;
  width: 60px;
  overflow: hidden;
}

.mini-allocation-progress {
  height: 100%;
  background: linear-gradient(90deg, #10b981 0%, #dc2626 100%);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.mini-allocation-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 9px;
  font-weight: 600;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

/* Currency badges */
.currency-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  text-align: center;
  display: inline-block;
}

.currency-aud {
  background-color: #dcfce7;
  color: #166534;
}

.currency-usd {
  background-color: #dbeafe;
  color: #1e40af;
}

.currency-gbp {
  background-color: #fef3c7;
  color: #92400e;
}

/* Table actions */
.admin-actions {
  display: flex;
  gap: 8px;
}

/* Empty state */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.empty-state-content h3 {
  margin: 0 0 8px 0;
  color: #374151;
  font-size: 18px;
}

.empty-state-content p {
  margin: 0 0 24px 0;
  color: #6b7280;
}

.empty-state-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .admin-actions-bar {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }
  
  .admin-search {
    order: 1;
  }
  
  .admin-filter {
    order: 2;
    justify-content: center;
  }
  
  .admin-actions {
    order: 3;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  
  .filter-select {
    width: 100%;
  }
  
  .actions-cell {
    width: auto;
  }
  
  .admin-actions {
    flex-direction: column;
    gap: 4px;
  }
  
  .empty-state-actions {
    flex-direction: column;
  }
  
  /* Hide some columns on mobile to save space */
  .admin-table table th:nth-child(4), /* Pools */
  .admin-table table td:nth-child(4),
  .admin-table table th:nth-child(7), /* Lenders */
  .admin-table table td:nth-child(7) {
    display: none;
  }
  
  .mini-allocation-bar {
    width: 50px;
  }
  
  .capital-amount,
  .allocated-amount {
    font-size: 12px;
  }
}
</style>