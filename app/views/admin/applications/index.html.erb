<% content_for :page_title, "Applications" %>

<div class="admin-actions-bar">
  <div class="admin-search">
    <%= form_with(url: admin_applications_path, method: :get, local: true, class: "search-form") do |form| %>
      <%= form.text_field :search, placeholder: "Search applications...", value: params[:search] %>
    <% end %>
  </div>
  
  <div class="admin-actions">
    <%= link_to "Add New Application", new_admin_application_path, class: "admin-btn admin-btn-primary" %>
  </div>
</div>

<div class="admin-table">
  <table>
    <thead>
      <tr>
        <th>User</th>
        <th>Address</th>
        <th>Home Value</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @applications.each do |application| %>
        <tr>
          <td>
            <div>
              <strong><%= application.user.display_name %></strong>
              <br>
              <small style="color: #6b7280;"><%= application.user.email %></small>
            </div>
          </td>
          <td><%= application.address %></td>
          <td>
            <span class="admin-badge admin-badge-user">
              <%= application.formatted_home_value %>
            </span>
          </td>
          <td>
            <% case application.status %>
            <% when 'created' %>
              <span class="admin-badge admin-badge-created">Created</span>
            <% when 'user_details' %>
              <span class="admin-badge admin-badge-user-details">User Details</span>
            <% when 'property_details' %>
              <span class="admin-badge admin-badge-property-details">Property Details</span>
            <% when 'income_and_loan_options' %>
              <span class="admin-badge admin-badge-income-loan">Income & Loan</span>
            <% when 'submitted' %>
              <span class="admin-badge admin-badge-submitted">Submitted</span>
            <% when 'processing' %>
              <span class="admin-badge admin-badge-processing">Processing</span>
            <% when 'rejected' %>
              <span class="admin-badge admin-badge-rejected">Rejected</span>
            <% when 'accepted' %>
              <span class="admin-badge admin-badge-accepted">Accepted</span>
            <% else %>
              <span class="admin-badge admin-badge-pending"><%= application.status.humanize %></span>
            <% end %>
          </td>
          <td><%= application.created_at.strftime("%B %d, %Y") %></td>
          <td>
            <%= link_to "View", admin_application_path(application), class: "admin-btn admin-btn-sm admin-btn-secondary" %>
            <%= link_to "Edit", edit_admin_application_path(application), class: "admin-btn admin-btn-sm admin-btn-primary" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <% if @applications.empty? %>
    <div style="padding: 40px; text-align: center; color: #6b7280;">
      <% if params[:search].present? %>
        No applications found matching "<%= params[:search] %>"
      <% else %>
        No applications found. <%= link_to "Create the first application", new_admin_application_path, class: "admin-link" %>
      <% end %>
    </div>
  <% end %>
</div>

<div class="admin-pagination">
  <%= paginate @applications %>
</div>