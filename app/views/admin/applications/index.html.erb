<% content_for :page_title, "Applications" %>

<!-- Flash messages container for Turbo Stream updates -->
<div id="flash-messages"></div>

<div class="admin-actions-bar">
  <div class="admin-search">
    <%= form_with(url: search_admin_applications_path, method: :post, local: false, class: "search-form", 
                  data: { turbo_stream: true, controller: "auto-submit" }) do |form| %>
      <%= form.text_field :search, placeholder: "Search by ID, address, name, or email...", value: params[:search], 
                         data: { action: "input->auto-submit#searchChanged" } %>
      <%= form.hidden_field :status, value: params[:status] %>
    <% end %>
  </div>
  
  <div class="admin-filter">
    <%= form_with(url: search_admin_applications_path, method: :post, local: false, class: "filter-form",
                  data: { turbo_stream: true, controller: "auto-submit" }) do |form| %>
      <%= form.select :status, 
            options_for_select([["All Statuses", ""]] + @status_options.map { |name, value| [name, value] }, params[:status]),
            {},
            { 
              class: "status-filter-select",
              data: { action: "change->auto-submit#filterChanged" }
            } %>
      <%= form.hidden_field :search, value: params[:search] %>
    <% end %>
  </div>
  
  <div class="admin-actions">
    <div class="applications-summary">
      Total Applications: <span id="applications-count" class="count-badge">
        <%= @applications.total_count || Application.where.not(status: :accepted).count %>
      </span>
    </div>
  </div>
</div>

<%= render 'results' %>