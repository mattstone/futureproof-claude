<% content_for :title, "Workflows" %>
<% content_for :breadcrumb, "Workflows" %>

<div class="workflow-manager" data-controller="email-workflows workflow-templates">
  <!-- Tabs Navigation -->
  <div class="tab-navigation admin-mb-6">
    <div class="tab-buttons">
      <button class="tab-button active" data-email-workflows-target="tab" data-tab="workflows" data-action="click->email-workflows#switchTab">
        <i class="fas fa-project-diagram"></i> Workflows
      </button>
      <button class="tab-button" data-email-workflows-target="tab" data-tab="templates" data-action="click->email-workflows#switchTab">
        <i class="fas fa-envelope"></i> Email Templates
      </button>
      <button class="tab-button" data-email-workflows-target="tab" data-tab="library" data-action="click->email-workflows#switchTab">
        <i class="fas fa-layer-group"></i> Template Library
      </button>
    </div>
  </div>

  <!-- Workflows Tab -->
  <div class="tab-content active" id="workflows-tab" data-email-workflows-target="tabContent">
    <!-- Header with stats and actions -->
    <div class="workflow-header">
      <div class="workflow-header-content">
        <div class="workflow-stats-grid">
          <div class="stat-card">
            <div class="stat-number"><%= @workflow_stats[:total] %></div>
            <div class="stat-label">Total Workflows</div>
          </div>
          <div class="stat-card">
            <div class="stat-number active"><%= @workflow_stats[:active] %></div>
            <div class="stat-label">Active</div>
          </div>
          <div class="stat-card">
            <div class="stat-number inactive"><%= @workflow_stats[:inactive] %></div>
            <div class="stat-label">Inactive</div>
          </div>
        </div>
        
        <div class="workflow-actions">
          <%= link_to new_admin_email_workflow_path, class: "site-btn site-btn-primary" do %>
            <i class="fas fa-plus"></i> New
          <% end %>
          
          <% if current_user&.admin? %>
            <%= link_to admin_business_process_workflows_path, class: "site-btn site-btn-secondary site-ml-2" do %>
              <i class="fas fa-rocket"></i> Try v2 Visual
            <% end %>
            <%= link_to admin_workflow_forms_path, class: "site-btn site-btn-success site-ml-2" do %>
              <i class="fas fa-edit"></i> Try Form Builder
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

  <!-- Filters -->
  <div class="workflow-filters admin-mb-6">
    <%= form_with url: admin_email_workflows_path, method: :get, local: false, 
                  data: { turbo_frame: "workflows-content", controller: "auto-submit" },
                  class: "filter-form admin-filter-form" do |form| %>
      <div class="filter-group">
        <%= form.select :trigger_type, 
                        options_for_select([['All Triggers', '']] + 
                        @trigger_types.map { |type| [type.humanize, type] }, 
                        params[:trigger_type]), 
                        {}, { 
                          class: "form-select", 
                          data: { action: "change->auto-submit#filterChanged" } 
                        } %>
      </div>
      
      <div class="filter-group">
        <%= form.select :active, 
                        options_for_select([['All Status', ''], ['Active', 'true'], ['Inactive', 'false']], 
                        params[:active]), 
                        {}, { 
                          class: "form-select",
                          data: { action: "change->auto-submit#filterChanged" }
                        } %>
      </div>
    <% end %>
  </div>

  <!-- Workflows Content Frame -->
  <%= render 'workflows_content', workflows: @workflows, workflow_stats: @workflow_stats %>
  </div>

  <!-- Email Templates Tab -->
  <div class="tab-content" id="templates-tab" data-email-workflows-target="tabContent">
    <div class="templates-header">
      <div class="templates-header-content">
        <h3>Email Templates</h3>
        <%= link_to new_admin_email_template_path, class: "admin-btn admin-site-btn-primary" do %>
          <i class="fas fa-plus"></i> New
        <% end %>
      </div>
    </div>
    
    <div class="templates-content">
      <div class="templates-loading">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i> Loading templates...
        </div>
      </div>
    </div>
  </div>

  <!-- Template Library Tab -->
  <div class="tab-content" id="library-tab" data-email-workflows-target="tabContent">
    <div class="library-header admin-mb-6">
      <h3>Workflow Template Library</h3>
      <p class="admin-text-muted">Pre-built workflows for common customer lifecycle scenarios</p>
    </div>
    
    <div class="library-loading">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i> Loading library...
      </div>
    </div>
  </div>
</div>

