<% content_for :page_title, "Privacy Policies" %>

<div class="admin-actions-bar">
  <div class="admin-summary">
    <div class="policies-summary">
      Total Versions: <span class="count-badge"><%= @privacy_policies.total_count || PrivacyPolicy.count %></span>
    </div>
  </div>
  
  <div class="admin-actions">
    <%= link_to "Create New Version", new_admin_privacy_policy_path, class: "admin-btn admin-btn-primary" %>
  </div>
</div>

<div class="admin-table">
  <table>
    <thead>
      <tr>
        <th>Policy Details</th>
        <th>Version</th>
        <th>Last Updated</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @privacy_policies.each do |privacy_policy| %>
        <tr class="<%= 'active-policy-row' if privacy_policy.is_active? %>">
          <td class="policy-details-cell">
            <div>
              <strong><%= privacy_policy.title %></strong>
            </div>
          </td>
          <td class="version-cell">
            <span class="version-badge"><%= privacy_policy.version %></span>
          </td>
          <td class="updated-cell">
            <%= privacy_policy.formatted_last_updated %>
          </td>
          <td class="status-cell">
            <% if privacy_policy.is_active? %>
              <span class="status-badge status-active">Active</span>
            <% else %>
              <span class="status-badge status-draft">Draft</span>
            <% end %>
          </td>
          <td class="created-cell">
            <%= privacy_policy.created_at.strftime("%b %d, %Y") %>
            <br>
            <small><%= time_ago_in_words(privacy_policy.created_at) %> ago</small>
          </td>
          <td class="actions-cell">
            <div class="admin-actions">
              <%= link_to "View", admin_privacy_policy_path(privacy_policy), class: "admin-btn admin-btn-sm admin-btn-secondary" %>
              <%= link_to "Edit", edit_admin_privacy_policy_path(privacy_policy), class: "admin-btn admin-btn-sm admin-btn-primary" %>
              <% unless privacy_policy.is_active? %>
                <%= link_to "Activate", 
                    activate_admin_privacy_policy_path(privacy_policy), 
                    method: :patch,
                    class: "admin-btn admin-btn-sm admin-btn-success",
                    data: { 
                      confirm: "Are you sure you want to activate this version? This will deactivate the current active version." 
                    } %>
              <% end %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <% if @privacy_policies.empty? %>
    <div class="empty-state">
      <h3>No Privacy Policies Found</h3>
      <p>Get started by creating your first Privacy Policy.</p>
      <%= link_to "Create First Privacy Policy", new_admin_privacy_policy_path, class: "admin-btn admin-btn-primary" %>
    </div>
  <% end %>
</div>

<div class="admin-pagination">
  <%= paginate @privacy_policies, window: 2 %>
</div>

<style>
/* Admin actions bar styling */
.admin-actions-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}

.admin-summary {
  display: flex;
  align-items: center;
}

.count-badge {
  background: #f3f4f6;
  color: #374151;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: 500;
  font-size: 0.875rem;
}

/* Policy details cell styling */
.policy-details-cell {
  min-width: 200px;
}

/* Version badge styling */
.version-badge {
  background-color: #dbeafe;
  color: #1e40af;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Status badges */
.status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-active {
  background-color: #d1fae5;
  color: #065f46;
}

.status-draft {
  background-color: #f3f4f6;
  color: #6b7280;
}

/* Updated and created cell styling */
.updated-cell, .created-cell {
  color: #374151;
}

.created-cell small {
  color: #6b7280;
  font-size: 0.75rem;
}

/* Active policy row highlighting */
.active-policy-row {
  background-color: #f0f9ff;
  border-left: 3px solid #0891b2;
}

.active-policy-row td {
  background-color: #f0f9ff;
}

/* Actions cell styling */
.actions-cell {
  white-space: nowrap;
  width: 10%;
  min-width: 140px;
}

.actions-cell .admin-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.actions-cell .admin-btn {
  padding: 4px 8px;
  font-size: 12px;
  margin: 0;
}

/* Empty state styling */
.empty-state {
  padding: 40px;
  text-align: center;
  color: #6b7280;
}

.empty-state h3 {
  color: #374151;
  margin-bottom: 8px;
}

/* Responsive design */
@media (max-width: 768px) {
  .admin-actions-bar {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }
  
  .actions-cell .admin-actions {
    flex-direction: column;
    gap: 2px;
  }
  
  .actions-cell {
    width: auto;
    min-width: auto;
  }
}
</style>