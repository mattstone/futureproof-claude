<% content_for :page_title, "Error Notification Testing" %>

<div class="admin-actions-bar">
  <div></div>
  <div class="admin-actions">
    <%= link_to "Back to Dashboard", admin_root_path, class: "admin-btn admin-btn-secondary" %>
  </div>
</div>

<div class="admin-card">
  <div class="section-header">
    <h3>üö® Error Notification Testing</h3>
  </div>
  
  <div class="alert alert-warning">
    <strong>‚ö†Ô∏è Production Environment Only</strong><br>
    This testing interface is only available in production to test error email notifications.
    Each test will trigger a real error that will send an email to <strong>matt.stone@futureprooffinancial.co</strong>.
  </div>
  
  <div class="error-test-grid">
    <!-- General Application Error Test -->
    <div class="error-test-card">
      <h4>üí• General Application Error</h4>
      <p>Tests a standard Ruby exception that would occur during normal application errors.</p>
      <p><strong>Email Subject:</strong> [Futureproof ERROR] StandardError in Admin::ErrorTestController#test_error</p>
      
      <%= form_with url: test_error_admin_error_test_path, method: :post, class: "error-test-form" do |f| %>
        <%= f.submit "Test Application Error", 
            class: "admin-btn admin-btn-danger", 
            data: { 
              confirm: "This will trigger a test error and send an email notification to Matt Stone. Continue?" 
            } %>
      <% end %>
    </div>
    
    <!-- Database Error Test -->
    <div class="error-test-card">
      <h4>üóÉÔ∏è Database Error</h4>
      <p>Tests a database-related error that would occur during SQL execution failures.</p>
      <p><strong>Email Subject:</strong> [Futureproof ERROR] ActiveRecord::StatementInvalid in Admin::ErrorTestController#test_database_error</p>
      
      <%= form_with url: test_database_error_admin_error_test_path, method: :post, class: "error-test-form" do |f| %>
        <%= f.submit "Test Database Error", 
            class: "admin-btn admin-btn-danger", 
            data: { 
              confirm: "This will trigger a database error and send an email notification to Matt Stone. Continue?" 
            } %>
      <% end %>
    </div>
    
    <!-- View Error Test -->
    <div class="error-test-card">
      <h4>üé® View Rendering Error</h4>
      <p>Tests a view template error that would occur during page rendering failures.</p>
      <p><strong>Email Subject:</strong> [Futureproof ERROR] ActionView::MissingTemplate in Admin::ErrorTestController#test_view_error</p>
      
      <%= form_with url: test_view_error_admin_error_test_path, method: :post, class: "error-test-form" do |f| %>
        <%= f.submit "Test View Error", 
            class: "admin-btn admin-btn-danger", 
            data: { 
              confirm: "This will trigger a view error and send an email notification to Matt Stone. Continue?" 
            } %>
      <% end %>
    </div>
  </div>
  
  <div class="testing-instructions">
    <h4>üìã Testing Instructions</h4>
    <ol>
      <li><strong>Choose a test type</strong> from the options above</li>
      <li><strong>Click the test button</strong> and confirm the action</li>
      <li><strong>Wait for the error</strong> - you'll see a 500 error page (this is expected)</li>
      <li><strong>Check Matt's email</strong> at matt.stone@futureprooffinancial.co for the error notification</li>
      <li><strong>Verify email content</strong> includes error details, backtrace, and request information</li>
      <li><strong>Return to this page</strong> to test other error types if needed</li>
    </ol>
    
    <div class="alert alert-info">
      <strong>üí° What to expect in the error email:</strong>
      <ul>
        <li>Subject line with error type and location</li>
        <li>Full exception message and backtrace</li>
        <li>Request details (URL, parameters, headers)</li>
        <li>Session information</li>
        <li>Server environment details</li>
        <li>Exact timestamp of the error</li>
      </ul>
    </div>
    
    <div class="alert alert-warning">
      <strong>üîí Security Notes:</strong>
      <ul>
        <li>This interface is only available to Futureproof admins</li>
        <li>Tests are logged for audit purposes</li>
        <li>Use sparingly to avoid email spam</li>
        <li>Remove or disable this interface if not needed</li>
      </ul>
    </div>
  </div>
</div>

<style>
.error-test-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.error-test-card {
  background: #fff;
  border: 2px solid #ef4444;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);
}

.error-test-card h4 {
  margin: 0 0 12px 0;
  color: #dc2626;
  font-size: 16px;
  font-weight: 600;
}

.error-test-card p {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #6b7280;
  line-height: 1.5;
}

.error-test-form {
  margin-top: 16px;
}

.testing-instructions {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #e5e7eb;
}

.testing-instructions h4 {
  margin: 0 0 16px 0;
  color: #374151;
  font-size: 16px;
  font-weight: 600;
}

.testing-instructions ol {
  margin: 0 0 20px 0;
  padding-left: 20px;
}

.testing-instructions ol li {
  margin-bottom: 8px;
  font-size: 14px;
  line-height: 1.5;
}

.alert {
  padding: 12px 16px;
  border-radius: 6px;
  margin: 16px 0;
  font-size: 14px;
}

.alert-warning {
  background: #fef3cd;
  border: 1px solid #fbbf24;
  color: #92400e;
}

.alert-info {
  background: #dbeafe;
  border: 1px solid #60a5fa;
  color: #1e40af;
}

.alert ul {
  margin: 8px 0 0 0;
  padding-left: 20px;
}

.alert ul li {
  margin-bottom: 4px;
}
</style>