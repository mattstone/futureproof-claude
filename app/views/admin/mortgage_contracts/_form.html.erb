<%= form_with model: [:admin, @mortgage, @mortgage_contract], local: true, class: "admin-form" do |form| %>
  <% if @mortgage_contract.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(@mortgage_contract.errors.count, "error") %> prohibited this Mortgage Contract from being saved:</h4>
      <ul>
        <% @mortgage_contract.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="admin-form-group">
    <%= form.label :title, class: "admin-form-label" %>
    <%= form.text_field :title, class: "admin-form-input", placeholder: "e.g., Equity Preservation Mortgage Contract" %>
  </div>

  <div class="csp-spacer-20"></div>

  <div class="admin-form-group">
    <% if @mortgage_contract.persisted? %>
      <label class="admin-form-label">Version & Status</label>
      <div class="version-status-info">
        <div class="admin-form-input csp-inline-readonly">
          Version <%= @mortgage_contract.version %>
        </div>
        <span class="admin-badge admin-badge-<%= @mortgage_contract.status_color %>"><%= @mortgage_contract.status %></span>
      </div>
    <% else %>
      <label class="admin-form-label">Version</label>
      <div class="admin-form-input csp-readonly-field">
        Version <%= (MortgageContract.maximum(:version) || 0) + 1 %> (new contract)
      </div>
    <% end %>
  </div>

  <div class="csp-spacer-20"></div>

  <div class="admin-form-group">
    <%= form.label :content, "Contract Content (using simple markup)", class: "admin-form-label" %>
    <div class="markup-help">
      <p><strong>Mortgage Contract Markup Guide:</strong></p>
      <ul>
        <li><code>## Section Title</code> → Creates a main section with heading</li>
        <li><code>### Sub-section</code> → Creates a sub-section</li>
        <li><code>- Bullet point</code> → Creates bulleted lists</li>
        <li><code>**Bold text**</code> → Makes text bold</li>
        <li><code>**Field:** Value</code> → Creates structured loan details</li>
        <li><code>Lender: Name</code> → Contact information block</li>
      </ul>
    </div>
    
    <%= form.text_area :content, 
        class: "admin-form-textarea markup-editor", 
        rows: 30,
        placeholder: 'Use simple markup to format your contract content. See the guide above for examples.',
        data: {
          "markup-editor-target": "editor"
        } %>
  </div>

  <div class="admin-form-actions csp-actions-margin">
    <% if @mortgage_contract.persisted? %>
      <% if @mortgage_contract.draft? %>
        <%= form.submit "Update Contract", class: "admin-btn admin-btn-primary" %>
      <% else %>
        <%= form.submit "Create New Version", class: "admin-btn admin-btn-primary" %>
      <% end %>
    <% else %>
      <%= form.submit "Create Contract (Draft)", class: "admin-btn admin-btn-primary" %>
    <% end %>
    <button type="button" 
            data-markup-editor-target="previewButton"
            data-preview-target="button"
            class="admin-btn admin-btn-success">Preview Contract</button>
    <%= link_to "Cancel", admin_mortgage_mortgage_contracts_path(@mortgage), class: "admin-btn admin-btn-secondary" %>
  </div>
<% end %>

