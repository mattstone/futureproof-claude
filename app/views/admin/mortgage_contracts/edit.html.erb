<% content_for :page_title, "Edit Mortgage Contract" %>

<div class="admin-actions-bar">
  <div>
    <%= link_to "â† Back to Mortgage", admin_mortgage_path(@mortgage), class: "admin-btn admin-btn-secondary" %>
  </div>
  
  <div class="admin-actions">
    <% if @mortgage_contract.persisted? %>
      <%= link_to "View Contract", admin_mortgage_mortgage_contract_path(@mortgage, @mortgage_contract), class: "admin-btn admin-btn-info" %>
    <% end %>
  </div>
</div>

<div class="contract-editor-layout">
  <div class="contract-form-column">
    <div class="admin-form-container">
      <% if @mortgage_contract.persisted? && @mortgage_contract.published? %>
        <h2>Create New Version</h2>
        
        <div class="version-info">
          <p><strong>Editing Published Contract:</strong> Since this contract is already published, editing will create a new draft version (Version <%= (MortgageContract.maximum(:version) || 0) + 1 %>).</p>
          <p>The original published version will remain unchanged until the new version is published.</p>
        </div>
      <% else %>
        <h2>Edit Contract <span class="version-label">Version <%= @mortgage_contract.version %></span></h2>
        
        <% if @mortgage_contract.draft? %>
          <div class="draft-info">
            <p><strong>Editing Draft:</strong> This contract is currently a draft. You can freely edit it before publishing.</p>
          </div>
        <% end %>
      <% end %>

      <%= render 'form' %>
    </div>
  </div>
  
  <div class="contract-preview-column">
    <div class="preview-container">
      <div class="preview-header">
        <h3>Live Preview</h3>
        <p>See your changes in real-time</p>
      </div>
      <div class="markup-preview" 
           data-controller="markup-editor" 
           data-markup-editor-target="preview"
           data-markup-editor-legal-type-value="contract"
           id="markup-preview-standalone">
        <p class="preview-note">Contract preview will appear here as you type...</p>
      </div>
    </div>
  </div>
</div>

