<% if @success %>
  <!-- Update the existing relationships (left column) -->
  <%= turbo_stream.replace "existing-relationships" do %>
    <div id="existing-relationships">
      <div class="relationship-list">
        <% @lender.lender_wholesale_funders.includes(:wholesale_funder).each do |relationship| %>
          <div class="relationship-card" data-wholesale-funder-id="<%= relationship.wholesale_funder.id %>">
            <div class="relationship-header">
              <h5><%= relationship.wholesale_funder.name %></h5>
              <div class="relationship-actions">
                <span class="status-badge <%= relationship.status_badge_class %>">
                  <%= relationship.status_display %>
                </span>
                <%= button_to "Toggle", toggle_active_admin_lender_wholesale_funder_path(@lender, relationship),
                              method: :patch, class: "admin-btn admin-btn-sm",
                              remote: true, form: { style: "display: inline;" } %>
                <%= button_to "Remove", admin_lender_wholesale_funder_path(@lender, relationship),
                              method: :delete, class: "admin-btn admin-btn-danger admin-btn-sm",
                              remote: true, data: { confirm: "Are you sure you want to remove #{relationship.wholesale_funder.name}?" },
                              form: { style: "display: inline;" } %>
              </div>
            </div>
            <div class="relationship-details">
              <div class="detail-row">
                <span class="detail-label">Country</span>
                <span class="detail-value"><%= relationship.wholesale_funder.country %></span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Currency</span>
                <span class="detail-value"><%= relationship.wholesale_funder.currency_display %></span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Created</span>
                <span class="detail-value"><%= relationship.created_at.strftime("%b %d, %Y") %></span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Show success message -->
  <%= turbo_stream.prepend "flash-messages" do %>
    <div class="alert alert-success" id="temp-notice">
      <%= @message %>
    </div>
  <% end %>

<% else %>
  <!-- Show error message -->
  <%= turbo_stream.prepend "flash-messages" do %>
    <div class="alert alert-error">
      <%= @message %>
    </div>
  <% end %>
<% end %>

