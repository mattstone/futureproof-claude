
<div class="dashboard-sections">
  
  <% if @section == 'applications' %>
    <!-- Applications Section -->
    <% if @submitted_applications.any? %>
      <div class="summary-section">
        <%= render 'application_management' %>
      </div>
    <% else %>
      <div class="summary-section">
        <h3 class="summary-section-title">No Applications Yet</h3>
        <div class="empty-state">
          <p>You haven't submitted any applications yet.</p>
          <div class="empty-state-actions">
            <%= link_to "Start New Application", "/start-application", class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    <% end %>
  <% elsif @section == 'contracts' %>
    <!-- Contracts Section -->
    <% if @contracts&.any? %>
      <div class="summary-section">
        <%= render 'contract_management' %>
      </div>
    <% else %>
      <div class="summary-section">
        <h3 class="summary-section-title">No Contracts Yet</h3>
        <div class="empty-state">
          <p>You don't have any active contracts yet. Contracts will appear here once your applications are approved.</p>
          <div class="empty-state-actions">
            <%= link_to "View Applications", dashboard_path(section: 'applications'), class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <!-- Regular Dashboard Content -->
          
          <!-- Current Application -->
          <% if @current_application %>
            <div class="summary-section">
              <h3 class="summary-section-title">Current Application</h3>
              <div class="application-status-card">
                <div class="status-header">
                  <div class="status-info">
                    <h4>Application #<%= @current_application.id.to_s.rjust(6, '0') %></h4>
                    <span class="status-badge <%= @current_application.status_badge_class %>">
                      <%= @current_application.status_display %>
                    </span>
                  </div>
                  <div class="progress-indicator">
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: <%= @current_application.progress_percentage %>%"></div>
                    </div>
                    <span class="progress-text"><%= @current_application.progress_percentage %>% Complete</span>
                  </div>
                </div>
                
                <div class="application-details">
                  <div class="detail-item">
                    <span class="detail-label">Property Address:</span>
                    <span class="detail-value"><%= @current_application.address || "Not provided" %></span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Property Value:</span>
                    <span class="detail-value"><%= @current_application.home_value ? @current_application.formatted_home_value : "Not provided" %></span>
                  </div>
                  <% if @current_application.mortgage.present? %>
                    <div class="detail-item">
                      <span class="detail-label">Mortgage Type:</span>
                      <span class="detail-value"><%= @current_application.mortgage.name %></span>
                    </div>
                  <% end %>
                  <div class="detail-item">
                    <span class="detail-label">Last Updated:</span>
                    <span class="detail-value"><%= @current_application.updated_at.strftime("%B %d, %Y at %I:%M %p") %></span>
                  </div>
                </div>

                <div class="application-actions">
                  <% case @current_application.status %>
                  <% when 'property_details' %>
                    <%= link_to "Continue Property Details", edit_application_path(@current_application), class: "btn btn-primary" %>
                  <% when 'income_and_loan_options' %>
                    <%= link_to "Continue Income & Loan", income_and_loan_application_path(@current_application), class: "btn btn-primary" %>
                    <%= link_to "Review Summary", summary_application_path(@current_application), class: "btn btn-outline-primary" %>
                  <% else %>
                    <%= link_to "View Details", @current_application, class: "btn btn-outline-primary" %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>

          <!-- Income Summary Section -->
          <div class="summary-section">
            <h3 class="summary-section-title">Income Summary</h3>
            <div style="padding: 20px; text-align: center; color: #64748b;">
              <p>Your income summary will be displayed here for all active Equity Preservation MortgagesÂ®</p>
            </div>
          </div>

  <% end %>
</div>

<% content_for :help_section do %>
  <%= render 'shared/account_help' %>
<% end %>