<!-- Security Alert Content -->
<div class="email-header-cell email-table-mb-32">
  <div style="font-size: 48px; margin-bottom: 16px;">ðŸ”’</div>
  <h1 class="email-security-title" style="font-size: 32px;">Security Alert</h1>
</div>

<!-- Alert Box -->
<table role="presentation" class="email-table-mb-24">
  <tr>
    <td class="email-notice-warning">
      <h2 class="email-notice-title-warning" style="font-size: 18px;">New Browser Sign-in Detected</h2>
      <p class="email-notice-text-warning">
        We detected a sign-in to your Futureproof account from a browser we haven't seen before.
      </p>
    </td>
  </tr>
</table>

<p class="email-content-text">
  Hello <%= @user.first_name || @user.email %>,
</p>

<p class="email-content-text-final">
  We're writing to let you know that your Futureproof account was accessed from a new browser or device.
</p>

<!-- Sign-in Details -->
<table role="presentation" class="email-table" style="background-color: #f8fafc; border: 2px solid #e5e7eb; border-radius: 8px; margin: 24px 0;">
  <tr>
    <td style="padding: 32px;">
      <h3 style="margin: 0 0 24px 0; color: #374151; font-size: 18px; font-weight: 600;">Sign-in Details:</h3>
      
      <div style="background-color: #ffffff; border-radius: 6px; padding: 20px; border: 1px solid #e5e7eb;">
        <table role="presentation" class="email-table">
          <tr>
            <!-- CRITICAL: DO NOT REDUCE PADDING - keeps coming back as unprofessional -->
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; font-weight: 600; color: #6b7280; font-size: 14px; width: 35%;">Time:</td>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; color: #374151; font-size: 14px;"><%= @sign_in_time.strftime("%B %d, %Y at %I:%M %p %Z") %></td>
          </tr>
          <tr>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; font-weight: 600; color: #6b7280; font-size: 14px;">Browser:</td>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; color: #374151; font-size: 14px;">
              <%
                browser_name = @browser_info['browser'] || 'Unknown Browser'
                formatted_browser = case browser_name.to_s.downcase
                when /chrome/
                  'Google Chrome'
                when /firefox/
                  'Mozilla Firefox'
                when /safari/
                  'Safari'
                when /edge/
                  'Microsoft Edge'
                when /opera/
                  'Opera'
                when /internet explorer|msie/
                  'Internet Explorer'
                else
                  browser_name.to_s.titleize
                end
              %>
              <%= formatted_browser %>
            </td>
          </tr>
          <tr>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; font-weight: 600; color: #6b7280; font-size: 14px;">Operating System:</td>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; color: #374151; font-size: 14px;">
              <%
                platform_name = @browser_info['platform'] || 'Unknown Operating System'
                formatted_platform = case platform_name.to_s.downcase
                when /mac|macintosh|darwin/
                  'macOS'
                when /windows|win32|win64/
                  'Windows'
                when /linux/
                  'Linux'
                when /android/
                  'Android'
                when /iphone|ipad|ios/
                  'iOS'
                when /unix/
                  'Unix'
                else
                  platform_name.to_s.titleize
                end
              %>
              <%= formatted_platform %>
            </td>
          </tr>
          <tr>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; font-weight: 600; color: #6b7280; font-size: 14px;">Language:</td>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; color: #374151; font-size: 14px;">
              <%
                language_code = @browser_info['language'] || 'Unknown Language'
                formatted_language = case language_code.to_s.downcase
                when 'en', 'en-us', 'en-gb', 'en-au', 'en-ca'
                  'English'
                when 'es', 'es-es', 'es-mx'
                  'Spanish'
                when 'fr', 'fr-fr', 'fr-ca'
                  'French'
                when 'de', 'de-de'
                  'German'
                when 'it', 'it-it'
                  'Italian'
                when 'pt', 'pt-br', 'pt-pt'
                  'Portuguese'
                when 'zh', 'zh-cn', 'zh-tw'
                  'Chinese'
                when 'ja', 'ja-jp'
                  'Japanese'
                when 'ko', 'ko-kr'
                  'Korean'
                when 'ru', 'ru-ru'
                  'Russian'
                when 'ar', 'ar-sa'
                  'Arabic'
                when 'hi', 'hi-in'
                  'Hindi'
                else
                  language_code.to_s.upcase
                end
              %>
              <%= formatted_language %>
            </td>
          </tr>
          <tr>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; font-weight: 600; color: #6b7280; font-size: 14px;">Device Type:</td>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; color: #374151; font-size: 14px;">
              <%
                browser_string = @browser_info.to_s.downcase
                device_type = if browser_string.include?('mobile') || browser_string.include?('android') || browser_string.include?('iphone')
                  'Mobile Device'
                elsif browser_string.include?('tablet') || browser_string.include?('ipad')
                  'Tablet'
                else
                  'Desktop Computer'
                end
              %>
              <%= device_type %>
            </td>
          </tr>
          <% if @ip_address %>
          <tr>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; font-weight: 600; color: #6b7280; font-size: 14px;">IP Address:</td>
            <td style="padding: 20px 24px; border-bottom: 1px solid #f3f4f6; color: #374151; font-size: 14px; font-family: 'Courier New', monospace;"><%= @ip_address %></td>
          </tr>
          <% end %>
          <% if @location %>
          <tr>
            <td style="padding: 20px 24px; font-weight: 600; color: #6b7280; font-size: 14px;">Location:</td>
            <td style="padding: 20px 24px; color: #374151; font-size: 14px;"><%= @location %></td>
          </tr>
          <% end %>
        </table>
      </div>
    </td>
  </tr>
</table>

<p class="email-content-text" style="margin: 24px 0 16px 0;">
  <strong class="email-strong">Was this you?</strong>
</p>

<p class="email-content-text">
  If you recognize this activity, you can ignore this email. We'll continue to monitor your account for any suspicious activity.
</p>

<p class="email-content-text" style="margin-bottom: 8px;">
  If you don't recognize this activity:
</p>

<ul class="email-content-text" style="margin-bottom: 32px; padding-left: 20px;">
  <li style="margin-bottom: 8px;">Change your password immediately</li>
  <li style="margin-bottom: 8px;">Review your account for any unauthorized changes</li>
  <li style="margin-bottom: 8px;">Contact our support team if you need assistance</li>
</ul>

<!-- Action Buttons -->
<table role="presentation" class="email-table" style="margin: 32px 0;">
  <tr>
    <td class="email-header-cell">
      <table role="presentation" class="email-button-table">
        <tr>
          <td style="padding: 0 8px;">
            <a href="<%= edit_user_registration_url %>" class="email-button-link" style="background-color: #dc2626;">Change Password</a>
          </td>
          <td style="padding: 0 8px;">
            <a href="mailto:info@futureprooffinancial.app" class="email-button-link" style="background-color: #6b7280;">Contact Support</a>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>